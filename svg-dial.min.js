!function(t){var i="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof define&&define.amd)define(["snap","exports"],function(e,n){i.DialKnob=t(i,n,e)});else if("undefined"!=typeof exports){var e=require("snapsvg");t(i,exports,e)}else i.DialKnob=t(i,{},i.Snap)}(function(t,i,e){var n=function(t,i,e){var n=t%90/90;return i*(1-n)+e*n},r=function(t){return t>=0&&90>t?[n(t,0,8),n(t,8,0)]:t>=90&&180>t?[n(t,8,0),n(t,0,-8)]:t>=180&&270>t?[n(t,0,-8),n(t,-8,0)]:[n(t,-8,0),n(t,0,8)]},o=function(t,i){var e={};for(key in i)e[key]=i[key];for(key in t)e[key]=t[key];return e};return i.DialKnob=function(t,i){this.el=t||"#svg-dial",this.options=o(i||{},{disabled:!1,frameBackgroundColor:"white",frameSize:200,ringBackground:"#888",innerBackground:"white",textFontFamily:"impact",textFontSize:"24px",textFontStyle:"none",textFontWeight:"none",ringWidth:50}),this.initialize()},i.DialKnob.create=function(t,e){return new i.DialKnob(t,e)},i.DialKnob.prototype={config:function(t){this.options=o(t,this.options)},setValue:function(t){var i=this.convertPercentageToAngle(t);this.updateDial(i)},initialize:function(){this.c=this.buildCanvas(),this.dial=this.buildDial(),dragOnMove=function(t,i,e,n,r){this.updateDial(this.getAngle(e,n)),this.executeCallback("onDragMove",[this.percentage])},dragOnStart=function(t,i,e){this.centerCoordinates=this.calculateDialCenterCoordinates(),this.updateDial(this.getAngle(t,i)),this.executeCallback("onDragStart",[this.percentage])},dragOnEnd=function(t,i,e){this.executeCallback("onDragEnd",[this.percentage])},this.moveKnob(this.convertPercentageToAngle(0)),this.innerCircle.drag(dragOnMove,dragOnStart,dragOnEnd,this,this,this),this.outerCircle.drag(dragOnMove,dragOnStart,dragOnEnd,this,this,this),this.executeCallback("onReady")},getAngle:function(t,i){return e.angle(this.centerCoordinates.x,this.centerCoordinates.y,t,i)},buildCanvas:function(){var t;t=this.el.jquery?this.el[0]:this.el instanceof HTMLElement?this.el:document.querySelector(this.el);var i='<svg style="width: '+this.options.frameSize+"px; height: "+this.options.frameSize+'px;"></svg>';return t.innerHTML=i,e(t.getElementsByTagName("svg")[0])},buildDial:function(){this.outerCircle=this.buildOuterCircle(),this.innerCircle=this.buildInnerCircle(),this.text=this.buildText()},buildOuterCircle:function(){var t=this.outerCircleAttributes={x:this.options.frameSize/2,y:this.options.frameSize/2,radius:this.options.frameSize/2},i=function(t){return[0,0,0,t,t/2,t/2,t,t,t,0]},e=this.c.circle(t.x,t.y,t.radius);return e.attr({fill:this.c.gradient(this.calculateFillColor(this.options.background)),mask:this.c.polyline(i(this.options.frameSize)).attr({fill:this.options.frameBackgroundColor})}),e},buildInnerCircle:function(){var t=this.innerCircleAttributes={x:this.outerCircleAttributes.x,y:this.outerCircleAttributes.y,radius:this.outerCircleAttributes.radius-this.options.ringWidth},i=function(){var i,e,n=this.options.ringWidth+5,r=t.x-t.radius+5;return i=this.outerCircleAttributes.radius+.5*n,e=this.outerCircleAttributes.radius-.5*n,this.c.polyline(r,e,r,i,r-n,this.outerCircleAttributes.radius)},e=this.c.circle(t.x,t.y,t.radius),n=this.generateDropShadow(),r=i.call(this);return e=this.c.group(e,r).attr({fill:this.calculateFillColor(this.options.innerBackground),filter:n,transform:["rotate(0",this.options.frameSize/2,this.options.frameSize/2].join(" ")})},buildText:function(){return this.c.text(this.options.frameSize/2,this.options.frameSize/2+this.options.textFontSize/3,"0%").attr({fontFamily:this.options.textFontFamily,fontSize:this.options.textFontSize,fontWeight:this.options.textFontWeight,fontStyle:this.options.textFontStyle,textAnchor:"middle"})},generateDropShadow:function(t){var i=o(t||{},{x:0,y:this.options.ringWidth/20,blur:3,color:"#000",opacity:.2});return this.c.filter(e.filter.shadow(i.x,i.y,i.blur,i.color,i.opacity))},updateText:function(t){this.text.attr({text:[Math.round(100*t),"%"].join("")})},calculateFillColor:function(t){return t=t instanceof Array?t:[t],"l(0, 0.5, 1, 0.5)"+t.join("-")},convertAngleToPercentage:function(t){var i,e=315,n=225;return i=t>e&&360>=t?45-(360-t):t+45,i/(n+45)},convertPercentageToAngle:function(t){var i=315,e=225;return unadjustedAngle=t*(e+45)+i,unadjustedAngle>360?unadjustedAngle-360:unadjustedAngle},moveKnob:function(t){var i=r(t),e=this.generateDropShadow({x:i[0],y:i[1]});this.innerCircle.attr({transform:["rotate(",t,this.options.frameSize/2,this.options.frameSize/2,")"].join(" "),filter:e})},updateDial:function(t){this.options.disabled||315>=t&&t>225||(this.moveKnob(t),this.percentage=this.convertAngleToPercentage(t),this.updateText(this.percentage))},calculateDialCenterCoordinates:function(){var t=this.outerCircle.node.getBoundingClientRect();return{x:t.left+t.height/2,y:t.top+t.height/2}},executeCallback:function(t,i){this.options[t]&&this.options[t].apply(null,i)}},i.DialKnob});